name: ðŸš€ Build Windows EXE & MSI

on:
  release:
    types: [published]

permissions:
  contents: write

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: â˜• Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '21'

      - name: ðŸ›  Setup Gradle
        uses: gradle/actions/setup-gradle@v3

      - name: ðŸ”¨ Build Fat JAR
        run: ./gradlew clean build

      - name: ðŸ“¦ Create EXE
        run: |
          jpackage ^
            --type exe ^
            --input build\libs ^
            --name DownloadManager ^
            --main-jar DownloadManager-1.0.0.jar ^
            --main-class manager.Main ^
            --dest dist ^
            --app-version 1.0.0 ^
            --vendor "Rachakonda Ravi" ^
            --description "Modern Java Download Manager" ^
            --icon assets\icon.ico


      - name: ðŸ“¦ Create MSI
        run: |
          jpackage ^
            --type msi ^
            --input build\libs ^
            --name DownloadManager ^
            --main-jar DownloadManager-1.0.0.jar ^
            --main-class manager.Main ^
            --dest dist ^
            --app-version 1.0.0 ^
            --vendor "Rachakonda Ravi" ^
            --description "Modern Java Download Manager" ^
            --icon assets\icon.ico ^
            --win-menu ^
            --win-shortcut
            
      - name: ðŸ“¦ Create Portable ZIP
        run: |
          mkdir portable
          xcopy dist\DownloadManager portable\DownloadManager /E /I
          powershell Compress-Archive -Path portable\DownloadManager -DestinationPath dist\DownloadManager-Portable.zip


      - name: ðŸ“¤ Upload EXE
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*.exe

      - name: ðŸ“¤ Upload MSI
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*.msi
          
      - name: ðŸ“¤ Upload ZIP
        uses: softprops/action-gh-release@v2
        with:
          files: dist/*.zip
